var last1msg="",last2msg="",inputFile;function getInputValueById(e){return document.getElementById(e).value}function setInputValueById(e,t){document.getElementById(e).value=t}function getRadioInputValueByName(e){for(var t=document.getElementsByName("format"),a=0,o=t.length;a<o;a++)if(t[a].checked)return t[a].value;return""}function outputInfo(e){document.getElementById("outputArea").innerHTML=e}function openTab(e,t){var a,o,n;for(o=document.getElementsByClassName("tabcontent"),a=0;a<o.length;a++)o[a].style.display="none";for(n=document.getElementsByClassName("tablinks"),a=0;a<n.length;a++)n[a].className=n[a].className.replace(" active","");document.getElementById(t).style.display="block",e.currentTarget.className+=" active"}function getActiveTab(){var e,t;for(t=document.getElementsByClassName("tabcontent"),e=0;e<t.length;e++)if("block"==t[e].style.display)return t[e].id}function outputCMDlog(e){var t=document.getElementById("ffmpegcmdoutput");t.value+=e+"\r\n",t.scrollTop=t.scrollHeight}function timeToSeconds(e){var t=e.split(":");return 60*parseFloat(t[0])*60+60*parseFloat(t[1])+parseFloat(t[2])+parseFloat("0."+t[3])}function video_convertAd(e,t,a,p,r){var i,o="input."+t.split(".").pop(),l=/Duration: (.*?), /,d=/time=(.*?) /,n=new Worker("/js/ff-worker.php?outputFormat=full");n.onmessage=function(e){var t=e.data;if("ready"===t.type&&window.File&&window.FileList&&window.FileReader);else if("stdout"==t.type)console.log(t.data),outputCMDlog(t.data);else if("stderr"==t.type){if(console.log(t.data),outputCMDlog(t.data),l.exec(t.data)&&(i=timeToSeconds(l.exec(t.data)[1])),d.exec(t.data)){var a=timeToSeconds(d.exec(t.data)[1]);i&&p((a/i*100).toFixed(2))}}else if("onExit"==t.type)0<t.outputFile.byteLength?r(t.outputFile,t.outFileName):r(null);else if("done"==t.type){var o=t.data.code,n=Object.keys(t.data.outputFiles);if(0==o&&0<n.length&&0<t.data.outputFiles[n[0]].byteLength){var s=n[0],u=t.data.outputFiles[s];r(u,s)}else r(null)}};var arguments;arguments=(a=a.replace("INPUT",o)).split(" "),n.postMessage({type:"command",arguments:arguments,files:[{name:o,data:e}]})}function video_convert(e,t,a,o,n,s,u,p,r,i,l,d,c,m,f,h){var g,v,arguments,y="input."+c.split(".").pop(),b=/Duration: (.*?), /,I=/time=(.*?) /;c.split(".").pop().toLowerCase();(v="webm"==n.toLowerCase()?new Worker("/js/ff-worker.php?outputFormat="+n):new Worker("/js/ff-worker-wasm.php?outputFormat="+n)).onmessage=function(e){var t=e.data;if("ready"===t.type&&window.File&&window.FileList&&window.FileReader);else if("stdout"==t.type)console.log("stdout:"),console.log(t.data);else if("stderr"==t.type){if(console.log("stderr:"),console.log(t.data),last2msg=last1msg,last1msg=t.data,b.exec(t.data)&&(g=timeToSeconds(b.exec(t.data)[1])),I.exec(t.data)){var a=timeToSeconds(I.exec(t.data)[1]);g&&f((a/g*100).toFixed(2))}}else if("onExit"==t.type)0<t.outputFile.byteLength?h(t.outputFile,t.outFileName):h(null);else if("done"==t.type){var o=t.data.code;if(0==t.data.length)return void h(null);var n=Object.keys(t.data.outputFiles);if(0==o&&0<n.length&&0<t.data.outputFiles[n[0]].byteLength){var s=n[0],u=t.data.outputFiles[s];h(u,s)}else h(null)}},(arguments=[]).push("-i"),arguments.push(y),"yes"==getInputValueById("disAudio")||""==r?arguments.push("-an"):(""!=t&&(arguments.push(s),arguments.push(t)),""!=a&&(arguments.push(u),arguments.push(a)),""!=o&&(arguments.push(p),arguments.push(o)),arguments.push("-acodec"),arguments.push(r),"vorbis"==r&&(arguments.push("-strict"),arguments.push("-2"))),""!=l&&(arguments.push(i),arguments.push("scale="+l));var _=getInputValueById("vrotate");""!=_&&(arguments.push("-vf"),arguments.push("transpose="+("90Clockwise"==_?"1":"2")));var w=getInputValueById("vflip");""!=w&&(arguments.push("-vf"),arguments.push(w));var B=getInputValueById("vcut");""!=B&&(arguments.push("-ss"),arguments.push(B.split("-")[0]),arguments.push("-to"),arguments.push(B.split("-")[1]));var x=getInputValueById("vcrop");""!=x&&(arguments.push("-vf"),arguments.push("crop="+x));var k=getInputValueById("vfps");switch(""!=k&&(arguments.push("-r"),arguments.push(k)),""!=m&&(arguments.push("-b:v"),arguments.push(m)),n.toUpperCase()){case"MP4":arguments.push("-c:v"),arguments.push(d),"libx264"==d&&(arguments.push("-x264opts"),arguments.push("cabac=1:ref=2:subme=6:me_range=16:chroma_me=1:trellis=1:chroma_qp_offset=-2:bframes=3:b_pyramid=2:b_adapt=1:b_bias=0:weightb=1:open_gop=0:weightp=1:keyint=250:keyint_min=15:scenecut=40:intra_refresh=0:rc_lookahead=30:mbtree=1:qpmax=69:qpstep=4")),arguments.push("output(js-video-converter.com).mp4");break;case"AVI":arguments.push("-c:v"),arguments.push(d),"libx264"==d&&(arguments.push("-x264opts"),arguments.push("cabac=1:ref=2:subme=6:me_range=16:chroma_me=1:trellis=1:chroma_qp_offset=-2:bframes=3:b_pyramid=2:b_adapt=1:b_bias=0:weightb=1:open_gop=0:weightp=1:keyint=250:keyint_min=15:scenecut=40:intra_refresh=0:rc_lookahead=30:mbtree=1:qpmax=69:qpstep=4")),arguments.push("output(js-video-converter.com).avi");break;case"MPG":arguments.push("-c:v"),arguments.push(d),arguments.push("output(js-video-converter.com).mpg");break;case"MOV":arguments.push("-c:v"),arguments.push(d),"libx264"==d&&(arguments.push("-x264opts"),arguments.push("cabac=1:ref=2:subme=6:me_range=16:chroma_me=1:trellis=1:chroma_qp_offset=-2:bframes=3:b_pyramid=2:b_adapt=1:b_bias=0:weightb=1:open_gop=0:weightp=1:keyint=250:keyint_min=15:scenecut=40:intra_refresh=0:rc_lookahead=30:mbtree=1:qpmax=69:qpstep=4")),arguments.push("output(js-video-converter.com).mov");break;case"FLV":arguments.push("-c:v"),arguments.push(d),"libx264"==d&&(arguments.push("-x264opts"),arguments.push("cabac=1:ref=2:subme=6:me_range=16:chroma_me=1:trellis=1:chroma_qp_offset=-2:bframes=3:b_pyramid=2:b_adapt=1:b_bias=0:weightb=1:open_gop=0:weightp=1:keyint=250:keyint_min=15:scenecut=40:intra_refresh=0:rc_lookahead=30:mbtree=1:qpmax=69:qpstep=4")),arguments.push("output(js-video-converter.com).flv");break;case"3GP":arguments.push("-c:v"),arguments.push(d),"libx264"==d&&(arguments.push("-x264opts"),arguments.push("cabac=1:ref=2:subme=6:me_range=16:chroma_me=1:trellis=1:chroma_qp_offset=-2:bframes=3:b_pyramid=2:b_adapt=1:b_bias=0:weightb=1:open_gop=0:weightp=1:keyint=250:keyint_min=15:scenecut=40:intra_refresh=0:rc_lookahead=30:mbtree=1:qpmax=69:qpstep=4")),arguments.push("output(js-video-converter.com).3gp");break;case"WEBM":arguments.push("-c:v"),arguments.push(d),arguments.push("-deadline"),arguments.push("realtime"),arguments.push("output(js-video-converter.com).webm");break;case"MKV":arguments.push("-c:v"),arguments.push(d),"libx264"==d&&(arguments.push("-x264opts"),arguments.push("cabac=1:ref=2:subme=6:me_range=16:chroma_me=1:trellis=1:chroma_qp_offset=-2:bframes=3:b_pyramid=2:b_adapt=1:b_bias=0:weightb=1:open_gop=0:weightp=1:keyint=250:keyint_min=15:scenecut=40:intra_refresh=0:rc_lookahead=30:mbtree=1:qpmax=69:qpstep=4")),arguments.push("output(js-video-converter.com).mkv");break;case"WMV":arguments.push("-c:v"),arguments.push(d),arguments.push("output(js-video-converter.com).wmv");break;case"GIF":arguments.push("-c:v"),arguments.push(d),arguments.push("output(js-video-converter.com).gif")}v.postMessage({type:"command",arguments:arguments,files:[{name:y,data:e}]})}function formatChange(curEncoder){var xhr=new XMLHttpRequest,url="/formatset.php?format="+curEncoder;xhr.open("GET",url),xhr.onload=function(){if(200===xhr.status){var x=xhr.responseText,xset=document.getElementById("formatSetDiv");eval(x)}else console.log("Request failed.  Returned status of "+xhr.status)},xhr.send()}function btnFormat_Click(){formatChange(getRadioInputValueByName("format"))}function getDuration(e,a){var o=/Duration: (.*?), /,n="",t=getRadioInputValueByName("format"),s=new Worker("/js/ff-worker-wasm.php?outputFormat="+t);s.onmessage=function(e){var t=e.data;"ready"===t.type&&window.File&&window.FileList&&window.FileReader||("stdout"==t.type?(console.log("stdout:"),console.log(t.data)):"stderr"==t.type?(console.log("stderr:"),console.log(t.data),o.exec(t.data)&&(n=timeToSeconds(o.exec(t.data)[1]))):"done"==t.type&&a(n))};var arguments,u="input."+t;(arguments=[]).push("-i"),arguments.push(u),s.postMessage({type:"command",arguments:arguments,files:[{name:u,data:e}]})}function getBriate(e,t,a){return(8192*parseFloat(t)/e-parseInt(a)).toFixed(2).toString()+"k"}function bReady(){window.File&&window.FileReader&&window.FileList&&window.Blob||outputInfo(str_browserNotSupport);var e=document.getElementById("filedropzone");function a(s,t){var e=getRadioInputValueByName("format");"Apple Video"!=e&&"Android Video"!=e||(e="mp4");var a=str_init.split("|");outputInfo("<i class='fa fa-spin3 animate-spin'></i>"+a[0]+"<br><small>"+a[1]+"</small>");var o=new XMLHttpRequest,n="/convertParam.php?x1="+getInputValueById("abitrate")+"&x2="+getInputValueById("asample")+"&x3="+getInputValueById("achannels")+"&x4="+e+"&x5="+getInputValueById("aencoder")+"&x6="+getInputValueById("vsize")+"&x7="+getInputValueById("vencoder");o.open("GET",n),o.onload=function(){if(200===o.status){var e=o.responseText.split(",");last2msg=last1msg="",video_convert(s,e[0],e[1],e[2],e[6],e[3],e[4],e[5],e[7],e[8],e[9],e[10],inputFile.name,t,function(e){outputInfo("<i class='fa fa-spin5 animate-spin'></i>"+e+"%")},function(e,t){if(e){var a=new Blob([e]),o=window.URL.createObjectURL(a),n=(e.byteLength/1024/1024).toFixed(2).toString();outputInfo("<i class='fa fa-ok fa-2x'></i><br>"+str_converSuccess+"<a download='"+t+"' href='"+o+"'>"+str_clicktoSave+"(output..."+t.split(".").pop()+","+n+"M)</a>"),"undefined"!=typeof pplike_manualshowlike&&pplike_manualshowlike()}else outputInfo(str_convertFailed+"<br> error info:"+last2msg+"<br>"+last1msg);s=null})}else console.log("Request failed.  Returned status of "+o.status)},o.send()}e.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),e.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault();for(var t,a=e.dataTransfer.files,o=0;t=a[o];o++)document.getElementById("curFileInput").innerHTML="<i class='fa fa-docs'></i>"+t.name,inputFile=t}),document.getElementById("bfile").addEventListener("change",function(e){for(var t,a=e.target.files,o=0;t=a[o];o++)document.getElementById("curFileInput").innerHTML="<i class='fa fa-docs'></i>"+t.name,inputFile=t},!1),document.getElementById("convertBtn").addEventListener("click",function(e){if(void 0!==inputFile){outputInfo("<i class='fa fa-spin3 animate-spin'></i>"+str_readingFile);var t=new FileReader;t.onload=function(e){var t=this.result;array=new Uint8Array(t),"normal"==getActiveTab()?""!=getInputValueById("vfilesize")?getDuration(array,function(e){a(array,""==e?getInputValueById("vbriate"):getBriate(e,getInputValueById("vfilesize"),getInputValueById("abitrate")))}):a(array,getInputValueById("vbriate")):(document.getElementById("ffmpegcmdoutput").value="",function(s){var e=str_init.split("|");outputInfo("<i class='fa fa-spin3 animate-spin'></i>"+e[0]+"<br><small>"+e[1]+"</small>");var t=new XMLHttpRequest,a="/convertParam.php?x1="+getInputValueById("abitrate")+"&x2="+getInputValueById("asample")+"&x3="+getInputValueById("achannels")+"&x4="+getRadioInputValueByName("format")+"&x5="+getInputValueById("aencoder")+"&x6="+getInputValueById("vsize")+"&x7="+getInputValueById("vencoder");t.open("GET",a),t.onload=function(){if(200===t.status){t.responseText.split(",");video_convertAd(s,inputFile.name,getInputValueById("ffmpegcmd"),function(e){outputInfo("<i class='fa fa-spin5 animate-spin'></i>"+e+"%")},function(e,t){if(e){var a=new Blob([e]),o=window.URL.createObjectURL(a),n=(e.byteLength/1024/1024).toFixed(2).toString();outputInfo("<i class='fa fa-ok fa-2x'></i><br>"+str_converSuccess+"<a download='"+t+"' href='"+o+"'>"+str_clicktoSave+"(output..."+t.split(".").pop()+","+n+"M)</a>"),"undefined"!=typeof pplike_manualshowlike&&pplike_manualshowlike()}else outputInfo(str_convertFailed);s=null})}else console.log("Request failed.  Returned status of "+t.status)},t.send()}(array))},t.readAsArrayBuffer(inputFile)}else outputInfo(str_pleaseLoadFile)}),document.getElementById("vpreset").addEventListener("change",function(e){var t=getInputValueById("vpreset");if(""!=t){var a=t.split(" ");setInputValueById("vsize",a[0]),setInputValueById("vfps",void 0===a[1]?"":a[1])}},!1),document.getElementById("vencoder").addEventListener("change",function(e){var t=getInputValueById("vencoder");"h263"==t?setInputValueById("vsize","352x288"):"mpeg1video"==t?setInputValueById("vfps","25"):"mpeg2video"==t?setInputValueById("vfps","25"):(setInputValueById("vsize",""),setInputValueById("vfps",""))},!1),document.getElementById("defaultOpen").click()}document.addEventListener("DOMContentLoaded",function(){bReady()},!1);